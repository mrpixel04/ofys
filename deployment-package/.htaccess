# Redirect all requests to the public directory
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>

# Set the default charset
AddDefaultCharset utf-8

# Disable directory browsing
Options -Indexes

# Enable Gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Protect .env file
<Files .env>
    Order allow,deny
    Deny from all
</Files>

# Protect sensitive files
<FilesMatch "^\.env|composer\.json|composer\.lock|package\.json|webpack\.mix\.js|artisan$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Set directory index
DirectoryIndex index.php index.html

# PHP settings - might help with some hosts
<IfModule mod_php8.c>
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value max_input_time 300
    php_flag display_errors Off
    php_flag log_errors On
</IfModule>

# Allow PHP files to be executed
<Files *.php>
    Order allow,deny
    Allow from all
</Files>

# Enable PHP execution
AddHandler application/x-httpd-php .php

# Try to use PHP 8.2 if available
<IfModule mod_suphp.c>
    suPHP_ConfigPath /opt/php82/lib
</IfModule>

# Alternative method for cPanel/LiteSpeed
<IfModule litespeed>
    AddHandler application/x-httpd-php82 .php
</IfModule>

# Alternative method for cPanel/Apache
<IfModule mod_fcgid.c>
    AddHandler fcgid-script .php
    FcgidWrapper /usr/local/cpanel/cgi-sys/php82 .php
</IfModule>

# PHP settings
php_value display_errors On
php_value display_startup_errors On

# Ensure pdo_mysql is loaded if available
php_value extension=pdo_mysql
